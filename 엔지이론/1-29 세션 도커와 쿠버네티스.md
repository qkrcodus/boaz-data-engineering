#### 컨테이너란?
개별 소프트웨어 실행에 필요한 실행 환경을 독립적으로 운용 가능하게 하는  운영 체제 격리 기술

---
#### vm 과 컨테이너의 차이?

![](https://i.imgur.com/Ccg7tIm.png)

각각의 VM들은 guest os가 존재하기에 규모와 복잡성이 커질 수밖에 없다.
이에 비해
컨테이너는 불필요하게 OS를 만들 필요가 없으며 컴퓨터 가지고 있는 인프라 리소스를 독립적으로 나눌 필요가 없다.

---
#### 도커란?
컨테이너를 만들 수 있고 관리 할 수 있게 해주는 기술

-  **`client-server 아키텍처`**
![](https://i.imgur.com/Xd5ZWxK.png)

- **`Docker daemon`**
**docker API 요청을 수신**하고, 이미지, 컨테이너, 네트워크를 관리

- **`Docker Client`**
docker 사용자가 docker와 상호작용하기 위한 방법입니다. **도커 명령어**를 수행해 **docker daemon과 통신**

- **`Docker Registry`**
**docker image를 저장**합니다. Docker Hub라는 public registry와 private registry가 있습니다.

- **`Docker 객체`**
**docker image**: 컨테이너 실행에 필요한 파일과 설정값 등을 포함합니다.
**docker container**: 도커 이미지의 실행 가능한 인스턴스입니다.

---
#### 명령어
- docker build : dockerfile 을 이용하여 이미지를 생성
- docker pull : registry에서 이미지를 풀 받아서 로컬 도커 데몬에 저장하자
- docker run : 지정된 이미지를 실행하여 컨테이너를 만든다.

![](https://i.imgur.com/fT5LULI.png)

FROM ubuntu:18.04 : 도커 이미지의 기반을 설정 - 이 베이스 이미지는 컨테이너의 운영 체제 역할을 한다. => 호스트 os 커널을 대체하는 것은 아니다.

RUN : Redis 서버를 설치한다. 

EXPOSE 6379 : Redis는 기본적으로 6379 포트를 사용하기에 컨테이너가 리스닝할 포트를 6379로 지정한다. 

---
#### 실습

#### Dockerfile을 생성해 빌드하고 실행시키기

1. dockerfile 로 이미지를 생성하기
   - 명령어 : docker build
```docker
# 3-Dockerfile
FROM ubuntu:18.04

RUN apt-get update && \\
    apt-get install -y redis-server && \\
    apt-get clean

EXPOSE 6379

CMD ["redis-server", "--protected-mode no"]
```

```bash
docker build -t redis:v1.0 -f 3-Dockerfile .
```
---
2. 이미지 잘 생성 되었는지 확인
 - 명령어 : docker image ls

REPOSITORY       TAG         IMAGE ID       CREATED          SIZE
redis            v1.0        86e103ba6f7c   14 minutes ago   93.7MB                                                                     86e103ba6f7c   14 minutes ago   93.7MB

---
3.  이미지에서 컨테이너를 실행
   - 명령어 : docker run
docker run -d -p 6379:6379 --name redis redis:v1.0

예를 들어 -p 8080:80 옵션을 적용하면, 호스트 시스템의 8080번 포트로 유입되는 트래픽은 모두 도커 컨테이너의 80번 포트로 전달됩니다.

--name redis : container의 이름을 지정
redis:v1.0 : 컨테이너 실행에 사용되는 이미지 이름을 지정

---
4. 컨테이너가 잘 실행되었는지 확인
   - 명령어 : docker container ls

---
5. 컨테이너에 접속해서 간단한 명령어를 실행
   - 명령어 : docker exec -it {container ID} bash

hostname -I # 172.X.X.X -> docker container의 ip 주소 확인
redis-cli ping # PONG

---
#### registry에서 이미지를 직접 가져와 컨테이너 만들기

1. docker pull debian
2. 풀 받은 이미지를 컨테이너에 넣기
   - 명령어 : docker commit {container id} {new image name}
3. 도커 이미지나 컨테이너 삭제하기 
   - 컨테이너 실행 중지 후 이미지 삭제 할 것
docker ps -a # 도커 container id 확인, -a 옵션은 중지된 컨테이너까지 전부 확인하겠다는 의미입니다.
docker stop {container id} # 컨테이너 중지 (중지되지 않은 컨테이너를 삭제하려면 에러를 반환합니다)
docker rm {container id} # 컨테이너 삭제

docker image ls
docker rmi {image id} # 이미지 삭제

---
#### docker-compose 으로 여러 컨테이너 생성하기
하나의 애플리케이션을 여러 개의 컨테이너가 구성할 때, docker-compose를 사용해 한 번에 컨테이너를 생성할 수 있다. 

1. .yml 파일에 작성
![](https://i.imgur.com/oE2r6Lu.png)

![](https://i.imgur.com/DI7kE68.png)

2. 도커 컴포즈 프로젝트 실행
   - 명령어 : docker compose up
![](https://i.imgur.com/r330wpz.png)

두개의 컨테이너가 생성된다.
3. 이미지 보기
   - 명령어 : docker image ls 

4. 컨테이너 보기 
   - 명령어 : docker ps
![](https://i.imgur.com/Nibn5zK.png)

5.  애플리케이션 종료
   - 명령어 : docker compose -f ./4-docker-compose.yml down
![](https://i.imgur.com/FWPBE67.png)

컨테이너가 사라졌다

---
#### 과제 
![](https://i.imgur.com/UIs6Y65.png)

![](https://i.imgur.com/Nibn5zK.png)
